CREATE TABLE IF NOT EXISTS `tbl_empleado` (
  `tbl_empleado_entbcrbanco` TEXT DEFAULT NULL COMMENT 'Si es el valor es 1 -> Banco caso de 2 es cooperativa.',
  `tbl_empleado_entbcrbancostr` TEXT DEFAULT NULL,
  `tbl_empleado_entidadbancaria` TEXT DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

<div class="form-group col-3">
	<label for="EntBancariaNombre">Nombre de Entidad Bancaria</label>
	<select class="form-control" id="selectEntBancariaNomb">
		<option value="" disabled selected>Seleccionar...</option>
		<optgroup label="Bancos">
			<option value="Banco del Pacífico">Banco del Pacífico</option>
			<option value="Banco Pichincha">Banco Pichincha</option>
			<option value="Banco Guayaquil">Banco Guayaquil</option>
			<option value="Banco de Machala">Banco de Machala</option>
			<option value="Banco Internacional">Banco Internacional</option>
			<option value="Banco Bolivariano">Banco Bolivariano</option>
			<option value="Banco ProCredit">Banco ProCredit</option>
			<option value="Banco de Loja">Banco de Loja</option>
			<option value="Banco Progreso">Banco Progreso</option>
			<option value="Banco Solidario">Banco Solidario</option>
			<option value="Banco D-Miro">Banco D-Miro</option>
			<option value="Banco del Austro">Banco del Austro</option>
			<option value="Banco de Guayaquil Internacional">Banco de Guayaquil Internacional</option>
			<option value="Banco Amazonas">Banco Amazonas</option>
			<option value="Banco Finca">Banco Finca</option>
		</optgroup>
		<optgroup label="Cooperativas">
			<option value="Cooperativa de Ahorro y Crédito Riobamba Ltda.">Cooperativa de Ahorro y Crédito Riobamba Ltda.</option>
			<option value="Cooperativa de Ahorro y Crédito Mushuc Runa">Cooperativa de Ahorro y Crédito Mushuc Runa</option>
			<option value="Cooperativa de Ahorro y Crédito JEP">Cooperativa de Ahorro y Crédito JEP</option>
			<option value="Cooperativa de Ahorro y Crédito Nacional Ltda.">Cooperativa de Ahorro y Crédito Nacional Ltda.</option>
			<option value="Cooperativa de Ahorro y Crédito Cooprogreso Ltda.">Cooperativa de Ahorro y Crédito Cooprogreso Ltda.</option>
			<option value="Cooperativa de Ahorro y Crédito Fernando Daquilema">Cooperativa de Ahorro y Crédito Fernando Daquilema</option>
			<option value="Cooperativa de Ahorro y Crédito Mujeres Unidas">Cooperativa de Ahorro y Crédito Mujeres Unidas</option>
			<option value="Cooperativa de Ahorro y Crédito CACPECO">Cooperativa de Ahorro y Crédito CACPECO</option>
			<option value="Cooperativa de Ahorro y Crédito 29 de Octubre">Cooperativa de Ahorro y Crédito 29 de Octubre</option>
			<option value="Cooperativa de Ahorro y Crédito de la Mujer Ecuatoriana">Cooperativa de Ahorro y Crédito de la Mujer Ecuatoriana</option>
		</optgroup>
	</select>
	<div style="display:none;" id="errorEntBancariaNomb" class="alert alert-danger" role="alert"></div>
</div>

script

$("#btnEnviar").click(function () {
	var genero=$('#selectGenero :selected').val();
	//alert("gen"+genero+" "+"cedu"+$("#txtnombre").val());
	// Previene la acción por defecto del formulario
	event.preventDefault();
	
	// Obtiene los datos del formulario
	var formData = new FormData($("#miFormulario")[0]);
	formData.append("cedula", $("#txtcedula").val());
	formData.append("nombre", $("#txtnombre").val());
	formData.append("apellido", $("#txtapellido").val());
	formData.append("genero", $('#selectGenero :selected').val());
	formData.append("estcivil", $("#selectEstCivil :selected").val());
	formData.append("fchanacimiento", $("#txtedad").val());
	formData.append("telefono", $("#txttelefono").val());
	formData.append("celular", $("#txtcel1").val());
	formData.append("celular2", $("#txtcel2").val());
	formData.append("email", $("#txtemail").val());
	
	formData.append("nacionalidad", $("#selectNacionalidad :selected").val());
	formData.append("direccion", $("#txtdireccion").val());
	formData.append("canton", $("#selectProvincia :selected").val());
	formData.append("cantonstr", $("#selectProvincia").find("option:selected").text());
	formData.append("parroquia", $("#selectParroquia :selected").val());
	formData.append("parroquiastr", $("#selectParroquia").find("option:selected").text());

	formData.append("nveleducativo", $("#txtneducativo :selected").val());
	formData.append("tloobtenido", $("#txttloobtenido").val());

	formData.append("entbancaria", $("#selectEntBancaria :selected").val());
	formData.append("entbancariastr", $("#selectEntBancaria").find("option:selected").text());
	formData.append("entbancarianomb", $("#selectEntBancariaNomb :selected").val());
	formData.append("tpocuenta", $("#selectTpoCuenta :selected").val());
	formData.append("nocuenta", $("#txtnocuenta").val());

	formData.append("discapacidad", $("#selectDiscapacidad :selected").val());
	formData.append("porcdiscapacidad", $("#txtporcentaje").val());
	formData.append("noconadis", $("#txtnoconadis").val());
   
	// Envía los datos al controlador de CodeIgniter usando Ajax
	$.ajax({
		type: "POST",
		url: "<?php echo site_url('form/procesarForm'); ?>",
		data: formData,
		contentType: false,
		processData: false,
		success: function (response) {
			// Maneja la respuesta del servidor (puede ser un mensaje de éxito, error, etc.)
			console.log(response);
			 // Maneja la respuesta del servidor
			var data = JSON.parse(response);
			var tiempoError = 30000;
			if (data.error) {
				// Muestra los mensajes de error en tu interfaz
				if (data.mensaje.cedula) {
					$('#errorCedula').html(data.mensaje.cedula);
					$("#errorCedula").show().fadeOut(tiempoError);
				}
				if (data.mensaje.nombre) {
					$('#errorNombre').html(data.mensaje.nombre);
					$("#errorNombre").show().fadeOut(tiempoError);
				}
				if (data.mensaje.apellido) {
					$('#errorApellido').html(data.mensaje.apellido);
					$("#errorApellido").show().fadeOut(tiempoError);
				}
				if (data.mensaje.genero) {
					$('#errorGenero').html(data.mensaje.genero);
					$("#errorGenero").show().fadeOut(tiempoError);
				}
				if (data.mensaje.estcivil) {
					$('#errorEstCivil').html(data.mensaje.estcivil);
					$("#errorEstCivil").show().fadeOut(tiempoError);
				}
				if (data.mensaje.fchanacimiento) {
					$('#errorFNacimiento').html(data.mensaje.fchanacimiento);
					$("#errorFNacimiento").show().fadeOut(tiempoError);
				}
				if (data.mensaje.celular) {
					$('#errorMovil').html(data.mensaje.celular);
					$("#errorMovil").show().fadeOut(tiempoError);
				}
				if (data.mensaje.email) {
					$('#errorEmail').html(data.mensaje.email);
					$("#errorEmail").show().fadeOut(tiempoError);
				}
				if (data.mensaje.nacionalidad) {
					$('#errorNacionalidad').html(data.mensaje.nacionalidad);
					$("#errorNacionalidad").show().fadeOut(tiempoError);
				}
				if (data.mensaje.direccion) {
					$('#errorDireccion').html(data.mensaje.direccion);
					$("#errorDireccion").show().fadeOut(tiempoError);
				}
				if (data.mensaje.canton) {
					$('#errorCanton').html(data.mensaje.canton);
					$("#errorCanton").show().fadeOut(tiempoError);
				}
				if (data.mensaje.parroquia) {
					$('#errorParroquia').html(data.mensaje.parroquia);
					$("#errorParroquia").show().fadeOut(tiempoError);
				}
				if (data.mensaje.nveleducativo) {
					$('#errorNvelEducativo').html(data.mensaje.nveleducativo);
					$("#errorNvelEducativo").show().fadeOut(tiempoError);
				}
				if (data.mensaje.tloobtenido) {
					$('#errorTloObtenido').html(data.mensaje.tloobtenido);
					$("#errorTloObtenido").show().fadeOut(tiempoError);
				}
				if (data.mensaje.entbancaria) {
					$('#errorEntBancaria').html(data.mensaje.entbancaria);
					$("#errorEntBancaria").show().fadeOut(tiempoError);
				}
				if (data.mensaje.entbancarianomb) {
					$('#errorEntBancariaNomb').html(data.mensaje.entbancarianomb);
					$("#errorEntBancariaNomb").show().fadeOut(tiempoError);
				}
				if (data.mensaje.tpocuenta) {
					$('#errorTpoCuenta').html(data.mensaje.tpocuenta);
					$("#errorTpoCuenta").show().fadeOut(tiempoError);
				}
				if (data.mensaje.nocuenta) {
					$('#errorNoCuenta').html(data.mensaje.nocuenta);
					$("#errorNoCuenta").show().fadeOut(tiempoError);
				}
				if (data.mensaje.porcentaje) {
					$('#errorPorcentaje').html(data.mensaje.porcentaje);
					$("#errorPorcentaje").show().fadeOut(tiempoError);
				}
				if (data.mensaje.noConadis) {
					$('#errorNoConadis').html(data.mensaje.noConadis);
					$("#errorNoConadis").show().fadeOut(tiempoError);
				}
				if (data.mensaje.archivo) {
					$('#errorArchivo').html(data.mensaje.archivo);
					$("#errorArchivo").show().fadeOut(tiempoError);
				}
			} else {
				// Si no hay errores, puedes hacer algo más, por ejemplo, redirigir o mostrar un mensaje de éxito
				console.log('Formulario procesado con éxito');
			}
		},
		error: function (error) {
			console.error("Error al procesar el formulario: ", error);
		}
	});
});

controller
	public function procesarForm() {
        if($this->input->post()){
            
            $discapacidad = $this->input->post('discapacidad');
            
            $this->load->library('form_validation');
    
            $this->form_validation->set_rules('cedula', 'Cedula', 'required');
            $this->form_validation->set_rules('nombre', 'Nombre', 'required');
            $this->form_validation->set_rules('apellido', 'Apellido', 'required');
            $this->form_validation->set_rules('genero', 'Genero', 'required');
            $this->form_validation->set_rules('estcivil', 'Estado Civil', 'required');
            $this->form_validation->set_rules('fchanacimiento', 'Fecha Nacimiento', 'required');
            $this->form_validation->set_rules('celular', 'Celular', 'required');
            $this->form_validation->set_rules('email', 'Email', 'required|regex_match[/@.*\.com/]');

            $this->form_validation->set_rules('nacionalidad', 'Nacionalidad', 'required');
            $this->form_validation->set_rules('direccion', 'Dirección', 'required');
            $this->form_validation->set_rules('canton', 'Canton', 'required');
            $this->form_validation->set_rules('parroquia', 'Parroquia', 'required');

            $this->form_validation->set_rules('nveleducativo', 'Nivel Educativo', 'required');
            $this->form_validation->set_rules('tloobtenido', 'Titulo Obtenido', 'required');

            $this->form_validation->set_rules('entbancaria', 'Entidad Bancaria', 'required');
            $this->form_validation->set_rules('entbancarianomb', 'Nombre de Entidad Bancaria', 'required');
            $this->form_validation->set_rules('tpocuenta', 'Tipo de Cuenta', 'required');
            $this->form_validation->set_rules('nocuenta', 'Numero de Cuenta', 'required');

            if($discapacidad == 'si'){
                $this->form_validation->set_rules('porcentaje', 'Porcentaje', 'required');
                $this->form_validation->set_rules('noConadis', 'Numero de Conadis', 'required');
            }

            $this->form_validation->set_rules('archivo', 'Archivo', 'callback_validar_archivo');
                    
            $mensajes = array(
                'required' => 'El campo %s es obligatorio.',
                'regex_match' => 'El campo %s debe contener el símbolo @ y .com.'
            );
        
            $this->form_validation->set_message($mensajes);
        
            if ($this->form_validation->run() == FALSE) {
                $errors = array(
                    'cedula' => form_error('cedula'),
                    'nombre' => form_error('nombre'),
                    'apellido' => form_error('apellido'),
                    'genero' => form_error('genero'),
                    'estcivil' => form_error('estcivil'),
                    'fchanacimiento' => form_error('fchanacimiento'),
                    'celular'=> form_error('celular'),
                    'email'=> form_error('email'),
                    'nacionalidad'=> form_error('nacionalidad'),
                    'direccion'=> form_error('direccion'),
                    'canton'=> form_error('canton'),
                    'parroquia'=> form_error('parroquia'),
                    'nveleducativo'=> form_error('nveleducativo'),
                    'tloobtenido'=> form_error('tloobtenido'),
                    'entbancaria'=> form_error('entbancaria'),
                    'entbancarianomb'=> form_error('entbancarianomb'),
                    'tpocuenta'=> form_error('tpocuenta'),
                    'nocuenta'=> form_error('nocuenta'),
                    'porcentaje'=> form_error('porcentaje'),
                    'noConadis'=> form_error('noConadis'),
                    'archivo'=> form_error('archivo')
                );
        
                echo json_encode(array('error' => true, 'mensaje' => $errors));
                exit();
            }else{
                $cedula = $this->input->post('cedula');
                $nombre = $this->input->post('nombre');
                $apellido = $this->input->post('apellido');
                $genero = $this->input->post('genero');
                $estcivil = $this->input->post('estcivil');
                $fchanacimiento = $this->input->post('fchanacimiento');
                $telefono = $this->input->post('telefono');
                $movil1 = $this->input->post('celular');
                $movil2 = $this->input->post('celular2');
                $email = $this->input->post('email');
                $nacionalidad = $this->input->post('nacionalidad');
                $direccion = $this->input->post('direccion');
                $canton = $this->input->post('canton');
                $cantonstr = $this->input->post('cantonstr');
                $parroquia = $this->input->post('parroquia');
                $parroquiastr = $this->input->post('parroquiastr');
                $nveleducativo = $this->input->post('nveleducativo');
                $tloobtenido = $this->input->post('tloobtenido');
                $entbancaria = $this->input->post('entbancaria');
                $entbancariastr = $this->input->post('entbancariastr');
                $entbancarianomb = $this->input->post('entbancarianomb');
                $tpocuenta = $this->input->post('tpocuenta');
                $nocuenta = $this->input->post('nocuenta');
                $discapacidad = $this->input->post('discapacidad');
                $porcdiscapacidad = $this->input->post('porcdiscapacidad');
                $noconadis = $this->input->post('noconadis');
                                
                $new_name = date('Ymdhis');
                
                $config['file_name'] = $new_name;
                $config['upload_path'] = './uploads/';
                $config['allowed_types'] = 'pdf';
                $config['max_size'] = 2048;
                $config['max_width'] = 2048;
                $config['max_height'] = 2048;

                $this->upload->initialize($config);
                
                $ruta_almacenamiento=NULL;

                if (!$this->upload->do_upload('archivo')) {
                    //$data['aviso'] = array('error' => $this->upload->display_errors());
                    $error = $this->upload->display_errors();

                    if (strpos($error, 'exceeds the maximum allowed size') !== FALSE) {
                        //echo json_encode(['error' => true, 'mensaje' => 'Error: El archivo excede el tamaño permitido (2 MB)']);
                        echo json_encode(['error' => true, 'mensaje' => ['file' => 'Error: El archivo excede el tamaño permitido (2 MB)']]);
                    } else {
                        // Verificar si el error es debido al tipo de archivo no permitido
                        if (strpos($error, 'The filetype you are attempting to upload is not allowed') !== FALSE) {
                            echo json_encode(['error' => true, 'mensaje' => ['file' => 'Error: Tipo de archivo no permitido. Por favor, sube un archivo PDF.']]);
                        } else {
                            //echo json_encode(['error' => true, 'mensaje' => 'Error al subir el archivo: ' . $error]);
                            echo json_encode(['error' => true, 'mensaje' => ['file' => 'Error al subir el archivo: ' . $error]]);
                        }
                    }
                } else {
                    $subida = $this->upload->data();
                    $foto = $new_name . $subida['file_ext'];
                    $ruta_almacenamiento = $config['upload_path'] . $foto;
                    //La siguiente llamada funciona correctamente, la uso para otras funciones.
                    //$this->Consultas_m->update_tabla($tabla, $campo, $foto, $id);
                    
                    $this->guardarForm($cedula,$apellido,$nombre,$fchanacimiento,$genero,$estcivil,
                    $email,$telefono,$movil1,$movil2,$nacionalidad,$direccion,$canton,$cantonstr,$parroquia,
                    $parroquiastr,$nveleducativo,$tloobtenido,$entbancaria,$entbancariastr,$entbancarianomb,
                    $tpocuenta,$nocuenta,$discapacidad,$porcdiscapacidad,$noconadis,$ruta_almacenamiento);
                    //echo json_encode(['success' => true, 'mensaje' => 'Formulario procesado con éxito', 'data' => $ruta_almacenamiento]);
                    echo json_encode(['success' => true, 'mensaje' => ['Ok' => 'Formulario procesado con éxito', 'data' => $ruta_almacenamiento]]);
                }
            }
            /**/
        }
    }
	
	public function guardarForm($cedula,$apellido,$nombre,$fchanacimiento,$genero,$estcivil,
	$email,$telefono,$movil1,$movil2,$nacionalidad,$direccion,$canton,$cantonstr,$parroquia,
	$parroquiastr,$nveleducativo,$tloobtenido,$entbancaria,$entbancariastr,$entbancarianomb,
	$tpocuenta,$nocuenta,$discapacidad,$porcdiscapacidad,$noconadis,$ruta_almacenamiento){
		$movil1new = ($movil1 != "") ? $movil1 : NULL; 
		$movil2new = ($movil2 != "") ? " / ".$movil2 : NULL;
		
		$AddEmp=array(
			"tbl_empleado_cedula"=>$cedula,
			"tbl_empleado_cdlaizq"=>substr($cedula, -6),
			"tbl_empleado_apellnomb"=>strtoupper($apellido." ".$nombre),
			"tbl_empleado_apellido"=>strtoupper($apellido),
			"tbl_empleado_nombres"=>strtoupper($nombre),
			"tbl_empleado_fchanac"=>$fchanacimiento,
			"tbl_empleado_gnro"=>strtoupper($genero),
			"tbl_empleado_estcivil"=>strtoupper($estcivil),
			"tbl_empleado_email"=>$email,
			"tbl_empleado_tlfnoConv"=>$telefono,
			"tbl_empleado_tlfnoCelar"=>$movil1new . $movil2new,
			"tbl_empleado_nacionalidad"=>strtoupper($nacionalidad),
			"tbl_empleado_direccion"=>strtoupper($direccion),
			"tbl_empleado_canton"=>$canton,
			"tbl_empleado_cantonstr"=>strtoupper($cantonstr),
			"tbl_empleado_parroquia"=>$parroquia,
			"tbl_empleado_parroquiastr"=>strtoupper($parroquiastr),
			"tbl_empleado_nveledu"=>strtoupper($nveleducativo),
			"tbl_empleado_tloobt"=>strtoupper($tloobtenido),
			"tbl_empleado_entbcrbanco"=>$entbancaria,
			"tbl_empleado_entbcrbancostr"=>strtoupper($entbancariastr),
			"tbl_empleado_entidadbancaria"=>strtoupper($entbancarianomb),
			"tbl_empleado_tpocuenta"=>strtoupper($tpocuenta),
			"tbl_empleado_numcuenta"=>$nocuenta,
			"tbl_empleado_discapacidad"=>strtoupper($discapacidad),
			"tbl_empleado_porcdisc"=>$porcdiscapacidad,
			"tbl_empleado_numcndis"=>$noconadis,
			"tbl_empleado_url"=>ltrim($ruta_almacenamiento,'./'),
			"tbl_empleado_fcharegistro"=>date('Y-m-d')
		);
		$id_empleado = $this->InfDomicilio_model->instData($AddEmp);
		if ($id_empleado !== false) {
			$AddUsr=array(
				"username"=>$cedula,
				"nombres"=>$nombre,
				"apellidos"=>$apellido,
				"password"=>md5($cedula),
				"tpo_usuario"=>'usuario',
				"tbl_empleado_idtbl_empleado"=>$id_empleado
			);
			$this->InfDomicilio_model->instDatausr($AddUsr);
		}
	}
	
	